import{d as $,r as c,a as q,p as O,b as v,o as _,c as u,e as i,w as l,q as e,f as S,t as p,F as j,s as G,h as Q,i as B,M as I,x as W,y as X,C as Y,_ as Z}from"./index-794815f9.js";const h=f=>(W("data-v-c4faab5e"),f=f(),X(),f),ee={style:{display:"flex","flex-wrap":"wrap",gap:"16px","margin-bottom":"16px"}},te={style:{display:"flex","align-items":"center"}},se=h(()=>e("div",{style:{"margin-right":"10px"}},"用户ID",-1)),ae={style:{display:"flex","align-items":"center"}},oe=h(()=>e("div",{style:{"margin-right":"10px"}},"用户邮箱",-1)),ie={style:{display:"flex",gap:"8px","margin-left":"auto"}},le={key:0},ne={key:1},de={key:0,class:"video-detail"},re={class:"video-preview-section"},ce={class:"video-player-box"},_e={key:0,class:"video-container"},ue=["src"],pe={key:1,class:"video-placeholder"},ve={class:"video-info-section"},he={class:"info-group"},me={class:"detail-item"},ge=h(()=>e("span",{class:"label"},"视频ID:",-1)),fe={class:"value"},ye={class:"detail-item"},we=h(()=>e("span",{class:"label"},"标题:",-1)),xe={class:"value"},be={class:"detail-item"},Se=h(()=>e("span",{class:"label"},"上传时间:",-1)),De={class:"value"},ke={class:"detail-item"},Ve=h(()=>e("span",{class:"label"},"状态:",-1)),Ie={class:"value"},Ce=h(()=>e("p",null,"确定要删除该视频吗？此操作不可恢复。",-1)),Te=$({__name:"index",setup(f){const D=c([]),k=c(!1),y=c(""),w=c(""),C=c(!1),V=c(!1),r=c(null),T=c(null),n=q({current:1,pageSize:10,total:0,showJumper:!0,pageSizeOptions:[10,20,50]}),P=[{colKey:"id",title:"视频ID",width:180,ellipsis:!0},{colKey:"user_id",title:"用户ID",width:180,ellipsis:!0},{colKey:"createTime",title:"创建时间",width:180,cell:(s,{row:t})=>K(t.createTime)},{colKey:"status",title:"状态",width:120,cell:"status"},{colKey:"gen_word_result",title:"单词卡",width:200,cell:"wordResult"},{colKey:"gen_video_asset_id",title:"生成视频AssetID",width:200,ellipsis:!0},{colKey:"gen_video_play",title:"生成视频链接",width:400,cell:"link",ellipsis:!0}],M=s=>({gen_word_processing:"warning",gen_word_failed:"danger",gen_video_processing:"primary",gen_video_failed:"danger",finished:"success"})[s]||"default",z=s=>({gen_word_processing:"单词卡生成中",gen_word_failed:"单词卡生成失败",gen_video_processing:"视频生成中",gen_video_failed:"视频生成失败",finished:"已完成"})[s]||"未知状态";function K(s){return s?new Date(s*1e3).toLocaleString():"-"}function N(s){const a=`search_self_video${s}lingotok`;return Y.SHA256(a).toString()}async function x(){var s,t;try{k.value=!0;const a=Date.now().toString(),m={Timestamp:a,Signature:N(a)},g={user_id:y.value||void 0,email:w.value||void 0,offset:(n.current-1)*n.pageSize,limit:n.pageSize},d=await B.post("https://api.lingotok.ai/api/v1/self_video/search_self_video",g,{headers:m});if(((s=d.data)==null?void 0:s.code)===200)D.value=(d.data.data.self_video_list||[]).map(b=>({...b,create_time:b.create_time||null})),n.total=d.data.data.total||0;else throw new Error(((t=d.data)==null?void 0:t.message)||"获取视频列表失败")}catch(a){console.error("获取视频列表失败:",a),I.error("获取视频列表失败："+(a.message||"未知错误")),D.value=[],n.total=0}finally{k.value=!1}}const R=async()=>{var s,t;if(T.value)try{const a=localStorage.getItem("username")||"",m={Timestamp:Date.now().toString(),Signature:N(Date.now().toString())},g={user_id:a,video_id:T.value.video_id},d=await B.post("https://api.lingotok.ai/api/v1/self_video/delete_self_video",g,{headers:m});if(((s=d.data)==null?void 0:s.code)===200)I.success("删除成功"),V.value=!1,x();else throw new Error(((t=d.data)==null?void 0:t.message)||"删除失败")}catch(a){console.error("删除失败:",a),I.error("删除失败："+(a.message||"未知错误"))}},L=()=>{n.current=1,x()},A=()=>{y.value="",w.value="",L()},F=s=>{n.current=s.current,n.pageSize=s.pageSize,x()};return O(()=>{x()}),(s,t)=>{const a=v("t-input"),m=v("t-button"),g=v("t-tag"),d=v("t-table"),b=v("t-space"),H=v("t-card"),U=v("t-dialog");return _(),u("div",null,[i(H,{class:"row-container",bordered:!1},{default:l(()=>[i(b,{direction:"vertical",style:{width:"100%"}},{default:l(()=>[e("div",ee,[e("div",te,[se,i(a,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),placeholder:"搜索用户ID",style:{width:"240px"},clearable:""},null,8,["modelValue"])]),e("div",ae,[oe,i(a,{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=o=>w.value=o),placeholder:"搜索用户邮箱",style:{width:"240px"},clearable:""},null,8,["modelValue"])]),e("div",ie,[i(m,{theme:"default",onClick:A},{default:l(()=>[S("重置")]),_:1}),i(m,{theme:"primary",onClick:L},{default:l(()=>[S("搜索")]),_:1})])]),i(d,{"row-key":"id",data:D.value,columns:P,bordered:!0,size:"small",loading:k.value,hover:!0,pagination:n,onPageChange:F},{status:l(({row:o})=>[i(g,{theme:M(o.status)},{default:l(()=>[S(p(z(o.status)),1)]),_:2},1032,["theme"])]),wordResult:l(({row:o})=>[o.gen_word_result?(_(),u("div",le,[(_(!0),u(j,null,G(o.gen_word_result,(J,E)=>(_(),u("div",{key:E},p(E)+": "+p(J),1))),128))])):(_(),u("span",ne,"-"))]),link:l(({row:o})=>[e("span",null,p(o.gen_video_play||"-"),1)]),_:1},8,["data","loading","pagination"])]),_:1})]),_:1}),i(U,{visible:C.value,"onUpdate:visible":t[2]||(t[2]=o=>C.value=o),header:"视频详情",footer:!1,width:"1200px","close-on-overlay-click":!0},{default:l(()=>[r.value?(_(),u("div",de,[e("div",re,[e("div",ce,[r.value.video_url?(_(),u("div",_e,[e("video",{ref:"videoPlayer",class:"video-player",src:r.value.video_url,controls:"",preload:"metadata"}," 您的浏览器不支持 HTML5 视频播放 ",8,ue)])):(_(),u("div",pe," 暂无视频 "))])]),e("div",ve,[e("div",he,[e("div",me,[ge,e("span",fe,p(r.value.video_id||"-"),1)]),e("div",ye,[we,e("span",xe,p(r.value.title||"-"),1)]),e("div",be,[Se,e("span",De,p(K(r.value.upload_time)),1)]),e("div",ke,[Ve,e("span",Ie,[i(g,{theme:M(r.value.status)},{default:l(()=>[S(p(z(r.value.status)),1)]),_:1},8,["theme"])])])])])])):Q("",!0)]),_:1},8,["visible"]),i(U,{visible:V.value,"onUpdate:visible":t[3]||(t[3]=o=>V.value=o),header:"删除确认",theme:"warning","confirm-btn":{content:"确认",theme:"danger"},"cancel-btn":{content:"取消"},onConfirm:R},{body:l(()=>[Ce]),_:1},8,["visible"])])}}});const ze=Z(Te,[["__scopeId","data-v-c4faab5e"]]);export{ze as default};
