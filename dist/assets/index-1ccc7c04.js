import{d as Ge,m as Ye,f as d,n as Ce,q as et,s as ne,g as tt,t as C,r as m,o as b,c as w,a as i,w as u,e as a,j as f,F as $e,v as De,x as h,i as de,y as ze,C as F,M as g,p as at,l as st,_ as ot}from"./index-da029508.js";import{u as lt,O as it}from"./renewData-d8028575.js";const c=j=>(at("data-v-d3253ee0"),j=j(),st(),j),nt={style:{display:"flex","flex-wrap":"wrap",gap:"16px","margin-bottom":"16px"}},dt={style:{display:"flex","align-items":"center"}},rt=c(()=>a("div",{style:{"margin-right":"10px"}},"视频ID",-1)),ut={style:{display:"flex","align-items":"center"}},ct=c(()=>a("div",{style:{"margin-right":"10px"}},"Asset ID",-1)),vt={style:{display:"flex","align-items":"center"}},_t=c(()=>a("div",{style:{"margin-right":"10px"}},"合集名称",-1)),pt={style:{display:"flex","align-items":"center"}},mt=c(()=>a("div",{style:{"margin-right":"10px"}},"合集Level",-1)),gt={style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},ht=c(()=>a("div",{style:{"margin-right":"10px"}},"合集Interest",-1)),ft={style:{display:"flex","flex-wrap":"wrap",gap:"8px","align-items":"center"}},yt={style:{display:"flex",gap:"8px","margin-left":"auto"}},bt={style:{display:"flex","align-items":"center"}},St={key:0,class:"video-detail"},kt={class:"video-preview-section"},xt={class:"video-player-box"},wt={key:0,class:"video-container"},Vt=["src","poster"],It={key:1,class:"video-cover"},Nt=["src"],Ct=c(()=>a("div",{class:"no-video-tip"},"暂无可播放视频",-1)),$t={key:2,class:"video-placeholder"},Dt={class:"subtitle-section"},zt={class:"subtitle-buttons"},Ut={key:0,class:"subtitle-editor"},Lt={class:"subtitle-header"},Mt={class:"subtitle-actions"},At={key:1,class:"subtitle-placeholder"},Ot={class:"video-info-section"},Pt={class:"info-group"},Bt={class:"detail-item"},Et=c(()=>a("span",{class:"label"},"Video ID:",-1)),Ht={class:"value"},Tt={class:"detail-item"},Rt=c(()=>a("span",{class:"label"},"名称:",-1)),Kt={class:"value"},Ft={class:"detail-item"},jt=c(()=>a("span",{class:"label"},"定制化标签:",-1)),Jt={class:"value"},qt={class:"detail-item"},Qt=c(()=>a("span",{class:"label"},"Asset ID:",-1)),Zt={class:"value"},Wt={class:"detail-item"},Xt=c(()=>a("span",{class:"label"},"视频时长:",-1)),Gt={class:"value"},Yt={class:"detail-item"},ea=c(()=>a("span",{class:"label"},"上架状态:",-1)),ta={class:"value"},aa={class:"detail-item"},sa=c(()=>a("span",{class:"label"},"合集名称:",-1)),oa={class:"value"},la={class:"detail-item",style:{"justify-content":"flex-end"}},ia={class:"info-group"},na={class:"detail-item"},da=c(()=>a("span",{class:"label"},"视频观看数:",-1)),ra={class:"value"},ua={class:"detail-item"},ca=c(()=>a("span",{class:"label"},"视频完播数:",-1)),va={class:"value"},_a={class:"detail-item"},pa=c(()=>a("span",{class:"label"},"视频点赞数:",-1)),ma={class:"value"},ga={class:"detail-item"},ha=c(()=>a("span",{class:"label"},"视频收藏数:",-1)),fa={class:"value"},ya={class:"info-group"},ba={class:"detail-item"},Sa=c(()=>a("span",{class:"label"},"合集ID:",-1)),ka={class:"value"},xa={class:"detail-item"},wa=c(()=>a("span",{class:"label"},"合集名称:",-1)),Va={class:"value"},Ia={class:"detail-item"},Na=c(()=>a("span",{class:"label"},"合集Level:",-1)),Ca={class:"value"},$a={class:"detail-item"},Da=c(()=>a("span",{class:"label"},"合集Interest:",-1)),za={class:"value"},Ua=Ge({__name:"index",setup(j){Ye();const J=d([]),G=d(!1),Y=d(!1),z=d(""),U=d(""),$=d(""),L=d(""),x=d([]),q=d(""),M=d(!1),l=d(null),Q=d([]),ee=Ce(()=>Q.value.map(t=>({label:t,value:t}))),k=et({current:1,pageSize:10,total:0,showJumper:!0,pageSizeOptions:[10,20,50]}),Ue=[{colKey:"video_id",title:"视频ID",width:230,ellipsis:!0,cell:(t,{row:e})=>i(m("t-link"),{theme:"primary",hover:"underline",onClick:()=>Fe(e)},{default:()=>[e.video_id]})},{colKey:"title",title:"视频名称",width:300,ellipsis:!0},{colKey:"asset_id",title:"AssetID",width:200,ellipsis:!0},{colKey:"series",title:"合集名称",width:200,cell:({row:t})=>{var e;return((e=t==null?void 0:t.series)==null?void 0:e.name)||"-"}},{colKey:"video_status",title:"上架状态",width:120}],Le=["food_drink","beauty_style","music","fitness_health","vlogs","comedy","sports","entertainment_culture","science_education","family","motivation_advice","dance","travel","gaming","pets","automotive_vehicle","diy","art","anime_comics","life_hacks","outdoors","oddly_satisfy"],Me=Ce(()=>Le.filter(t=>!x.value.includes(t)).map(t=>({label:t,value:t}))),Ae=t=>{t&&!x.value.includes(t)&&(x.value.push(t),q.value="",O())},Oe=t=>{x.value=x.value.filter(e=>e!==t),O()};function Pe(t){const s=`search_video${t}lingotok`;return F.SHA256(s).toString()}function Be(t){const s=`get_video${t}lingotok`;return F.SHA256(s).toString()}function Ee(t){const s=`update_video_info${t}lingotok`;return F.SHA256(s).toString()}function He(t){const s=`upload_video_draft_subtitle${t}lingotok`;return F.SHA256(s).toString()}function Te(t){const s=`get_all_series_name${t}lingotok`;return F.SHA256(s).toString()}function A(t="search_video"){const e=Date.now().toString();let s="";switch(t){case"get_video":s=Be(e);break;case"update_video_info":s=Ee(e);break;case"upload_video_draft_subtitle":s=He(e);break;default:s=Pe(e)}return{Timestamp:e,Signature:s}}async function D(){var t;G.value=!0;try{const e=A(),r={offset:(k.current-1)*k.pageSize,limit:k.pageSize,...z.value&&{video_id:z.value},...U.value&&{asset_id:U.value},...$.value&&{series_name:$.value},...L.value&&{series_level:L.value},...x.value.length>0&&{series_interest_list:x.value}},o=await C.post("https://testapi.lingotok.ai/api/v1/video/search_video",r,{headers:e});if(((t=o.data)==null?void 0:t.code)===200&&Array.isArray(o.data.data.video_list)){const v=o.data.data.video_list.map(y=>({...y,_statusLoading:!1}));J.value=v,k.total=o.data.data.total||0}else J.value=[],k.total=0,g.error("获取数据失败")}catch(e){console.error("获取视频列表失败:",e),J.value=[],k.total=0,g.error("获取数据失败")}finally{G.value=!1}}const Re=async(t,e)=>{var s,r;if(!(e!=null&&e.video_id)){g.warning("视频ID不存在");return}try{e._statusLoading=!0;const o=e.video_id,v=localStorage.getItem("username")||"unknown",y={video_id:o,username:v,title:e.title,status:t?"online":"offline",customize:e.customize||""},I=A("update_video_info"),_=await C.post("https://testapi.lingotok.ai/api/v1/video/update_video_info",y,{headers:I});if(((s=_.data)==null?void 0:s.code)===200)g.success("更新成功"),e.video_status=t?"online":"offline",D();else throw new Error(((r=_.data)==null?void 0:r.message)||"更新失败")}catch(o){console.error("更新视频信息失败:",o),g.error("更新失败："+(o instanceof Error?o.message:"未知错误")),await D()}finally{e._statusLoading=!1}},Ke=t=>{k.current=t.current,k.pageSize=t.pageSize,D()},O=()=>{k.current=1,D()},Fe=async t=>{var e;try{Y.value=!0;const s=A("get_video"),r=await C.post("https://testapi.lingotok.ai/api/v1/video/get_video",{video_id:t.video_id},{headers:s});((e=r.data)==null?void 0:e.code)===200?(l.value=r.data.data,M.value=!0):g.error("获取视频详情失败")}catch(s){console.error("获取视频详情失败:",s),g.error("获取视频详情失败")}finally{Y.value=!1}},je=t=>{if(!t)return"-";const e=Math.floor(t/1e3),s=Math.floor(e/60),r=Math.floor(s/60),o=s%60,v=e%60;return r>0?`${r}:${String(o).padStart(2,"0")}:${String(v).padStart(2,"0")}`:`${o}:${String(v).padStart(2,"0")}`},te=t=>({zh:"中文字幕",en:"英文字幕",ar:"阿拉伯语字幕",pinyin:"拼音字幕"})[t]||t,S=d(null),N=d(""),ae=d(!1),se=d(!1),Je=async t=>{try{S.value=t,ae.value=!0;const e=await C.get(t.subtitle_play_url);N.value=e.data}catch(e){console.error("获取字幕内容失败:",e),g.error("获取字幕内容失败"),N.value=""}finally{ae.value=!1}};d([]),d(null);const qe=async()=>{var t,e,s,r;if(!S.value||!N.value){g.warning("请先选择字幕并输入内容");return}if(S.value.language!=="zh"){g.warning("只能修改中文字幕");return}try{se.value=!0,console.log("开始保存字幕...");const o=new Blob([N.value],{type:"text/plain"}),v=Date.now(),y=localStorage.getItem("username")||"unknown",I=(e=(t=l.value)==null?void 0:t.video)==null?void 0:e.video_id,_=`draft_subtitle_${I}_${y}_${v}.srt`,le=new File([o],_,{type:"text/plain"});console.log("准备上传文件:",_);const ie=new it({access_key_id:"UI29JOFHTKQRBVVQ06TT",secret_access_key:"vaMNt6dy5cJvXDlkzoWVNx3M8O0H5aIkneZSMZom",server:"https://obs.me-east-1.myhuaweicloud.com",timeout:60}),T=`draft_subtitle/${_}`;console.log("开始上传到 OBS:",T);const Z=await ie.putObject({Bucket:"lingotok",Key:T,SourceFile:le});if(console.log("OBS 上传结果:",Z),Z.CommonMsg.Status===200){const R=`https://lingotok.obs.me-east-1.myhuaweicloud.com/${T}`;console.log("文件上传成功，URL:",R);const W={video_id:I,username:y,draft_subtitle_url:R};console.log("准备更新字幕信息:",W);const X=A("upload_video_draft_subtitle");console.log("请求头:",X);const n=await C.post("https://testapi.lingotok.ai/api/v1/video/upload_video_draft_subtitle",W,{headers:X});if(console.log("更新字幕信息响应:",n.data),((s=n.data)==null?void 0:s.code)===200)g.success("字幕保存成功"),S.value.subtitle_play_url=R;else throw new Error(((r=n.data)==null?void 0:r.message)||"更新失败")}else throw new Error("文件上传失败")}catch(o){console.error("保存字幕失败:",o),g.error("保存字幕失败："+(o instanceof Error?o.message:"未知错误"))}finally{se.value=!1}},P=d(null);ne(M,t=>{!t&&P.value&&P.value.pause()}),ne(M,t=>{t||(P.value&&P.value.pause(),S.value=null,N.value="")}),tt(()=>{var e;Xe();const t=lt();(e=t.searchParams)!=null&&e.seriesName?($.value=t.searchParams.seriesName,O(),t.setSearchParams({seriesName:""})):D()});const B=d(""),E=d("offline"),oe=d(!1),H=d(""),V=d("");ne(()=>l.value,t=>{var e;t!=null&&t.video&&(B.value=t.video.title||"",E.value=t.video.video_status||"offline",H.value=t.video.customize||"",V.value=((e=t.video.series)==null?void 0:e.name)||"")},{immediate:!0});const Qe=async()=>{var t,e,s,r;if(!((e=(t=l.value)==null?void 0:t.video)!=null&&e.video_id)){g.warning("视频ID不存在");return}try{oe.value=!0;const o=l.value.video.video_id,v=localStorage.getItem("username")||"unknown",y={video_id:o,username:v,title:B.value,status:E.value,customize:H.value,series_name:V.value};console.log("准备更新视频信息:",y);const I=A("update_video_info"),_=await C.post("https://testapi.lingotok.ai/api/v1/video/update_video_info",y,{headers:I});if(console.log("更新视频信息响应:",_.data),((s=_.data)==null?void 0:s.code)===200)g.success("更新成功"),l.value.video.title=B.value,l.value.video.video_status=E.value,l.value.video.customize=H.value,l.value.video.series?l.value.video.series.name=V.value:l.value.video.series={name:V.value},D();else throw new Error(((r=_.data)==null?void 0:r.message)||"更新失败")}catch(o){console.error("更新视频信息失败:",o),g.error("更新失败："+(o instanceof Error?o.message:"未知错误"))}finally{oe.value=!1}},Ze=()=>{O()},We=()=>{z.value="",U.value="",$.value="",L.value="",x.value=[],q.value="",O()};async function Xe(){var t;try{const e=Date.now().toString(),s=Te(e),r={Timestamp:e,Signature:s},o=await C.post("https://testapi.lingotok.ai/api/v1/video/get_all_series_name",{},{headers:r});((t=o.data)==null?void 0:t.code)===200&&Array.isArray(o.data.data.series_name_list)?Q.value=o.data.data.series_name_list:Q.value=[]}catch(e){console.error("获取系列名称失败:",e),Q.value=[]}}return(t,e)=>{const s=m("t-loading"),r=m("t-input"),o=m("t-select"),v=m("t-radio-button"),y=m("t-radio-group"),I=m("t-tag"),_=m("t-button"),le=m("t-switch"),ie=m("t-popconfirm"),T=m("t-table"),Z=m("t-space"),R=m("t-card"),W=m("t-textarea"),X=m("t-dialog");return b(),w("div",null,[i(s,{loading:Y.value,fullscreen:"",overlay:""},null,8,["loading"]),i(R,{class:"row-container",bordered:!1},{default:u(()=>[i(Z,{direction:"vertical",style:{width:"100%"}},{default:u(()=>[a("div",nt,[a("div",dt,[rt,i(r,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=n=>z.value=n),placeholder:"搜索视频ID（可选）",style:{width:"240px"},clearable:""},null,8,["modelValue"])]),a("div",ut,[ct,i(r,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=n=>U.value=n),placeholder:"搜索Asset ID（可选）",style:{width:"240px"},clearable:""},null,8,["modelValue"])]),a("div",vt,[_t,i(o,{modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=n=>$.value=n),placeholder:"选择合集名称（可选）",style:{width:"240px"},options:ee.value,clearable:"",filterable:""},null,8,["modelValue","options"])]),a("div",pt,[mt,i(y,{modelValue:L.value,"onUpdate:modelValue":e[3]||(e[3]=n=>L.value=n),variant:"default-filled"},{default:u(()=>[i(v,{value:""},{default:u(()=>[f("全部")]),_:1}),i(v,{value:"easy"},{default:u(()=>[f("Easy")]),_:1}),i(v,{value:"medium"},{default:u(()=>[f("Medium")]),_:1}),i(v,{value:"hard"},{default:u(()=>[f("Hard")]),_:1})]),_:1},8,["modelValue"])]),a("div",gt,[ht,a("div",ft,[(b(!0),w($e,null,De(x.value,n=>(b(),de(I,{key:n,theme:"primary",closable:"",onClose:K=>Oe(n)},{default:u(()=>[f(h(n),1)]),_:2},1032,["onClose"]))),128)),i(o,{modelValue:q.value,"onUpdate:modelValue":e[4]||(e[4]=n=>q.value=n),placeholder:"选择Interest（可选）",style:{width:"240px"},options:Me.value,onChange:Ae},null,8,["modelValue","options"])])]),a("div",yt,[i(_,{theme:"default",onClick:We},{default:u(()=>[f("重置")]),_:1}),i(_,{theme:"primary",onClick:Ze},{default:u(()=>[f("搜索")]),_:1})])]),i(T,{"row-key":"video_id",data:J.value,columns:Ue,bordered:!0,size:"small",loading:G.value,hover:!0,pagination:k,onPageChange:Ke},{video_status:u(({row:n})=>[a("div",bt,[i(ie,{content:`确认${n.video_status==="online"?"下架":"上架"}该视频吗？`,onConfirm:()=>Re(n.video_status!=="online",n)},{default:u(()=>[i(le,{loading:n._statusLoading,"model-value":n.video_status==="online",onChange:()=>{}},{label:u(({value:K})=>[f(h(K?"已上架":"已下架"),1)]),_:2},1032,["loading","model-value"])]),_:2},1032,["content","onConfirm"])])]),_:1},8,["data","loading","pagination"])]),_:1})]),_:1}),i(X,{visible:M.value,"onUpdate:visible":e[11]||(e[11]=n=>M.value=n),header:"视频详情",footer:!1,width:"1200px","close-on-overlay-click":!0},{default:u(()=>{var n,K,re,ue,ce,ve,_e,pe,me,ge,he,fe,ye,be,Se,ke,xe,we,Ve,Ie;return[l.value?(b(),w("div",St,[a("div",kt,[a("div",xt,[(n=l.value.video)!=null&&n.video_play_url?(b(),w("div",wt,[a("video",{ref_key:"videoPlayer",ref:P,class:"video-player",src:l.value.video.video_play_url,poster:(K=l.value.video)==null?void 0:K.video_cover_url,controls:"",preload:"metadata"}," 您的浏览器不支持 HTML5 视频播放 ",8,Vt)])):(re=l.value.video)!=null&&re.video_cover_url?(b(),w("div",It,[a("img",{src:l.value.video.video_cover_url,alt:"视频封面"},null,8,Nt),Ct])):(b(),w("div",$t," 暂无封面和视频 "))]),a("div",Dt,[a("div",zt,[(b(!0),w($e,null,De((ue=l.value.video)==null?void 0:ue.subtitle_list,p=>{var Ne;return b(),de(_,{key:p.language,variant:"outline",theme:((Ne=S.value)==null?void 0:Ne.language)===p.language?"primary":"default",onClick:La=>Je(p)},{default:u(()=>[f(h(te(p.language)),1)]),_:2},1032,["theme","onClick"])}),128))]),S.value?(b(),w("div",Ut,[a("div",Lt,[a("span",null,h(te(S.value.language))+"内容",1),a("div",Mt,[S.value.language==="zh"?(b(),de(_,{key:0,theme:"primary",size:"small",onClick:qe,loading:se.value},{default:u(()=>[f(" 保存 ")]),_:1},8,["loading"])):ze("",!0)])]),i(s,{loading:ae.value},{default:u(()=>[i(W,{modelValue:N.value,"onUpdate:modelValue":e[5]||(e[5]=p=>N.value=p),placeholder:`请输入${te(S.value.language)}内容`,autosize:{minRows:10,maxRows:20},readonly:S.value.language!=="zh"},null,8,["modelValue","placeholder","readonly"])]),_:1},8,["loading"])])):(b(),w("div",At," 请选择要编辑的字幕 "))])]),a("div",Ot,[a("div",Pt,[a("div",Bt,[Et,a("span",Ht,h(((ce=l.value.video)==null?void 0:ce.video_id)||"-"),1)]),a("div",Tt,[Rt,a("div",Kt,[i(r,{modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=p=>B.value=p),placeholder:"请输入视频名称",style:{width:"300px"}},null,8,["modelValue"])])]),a("div",Ft,[jt,a("div",Jt,[i(r,{modelValue:H.value,"onUpdate:modelValue":e[7]||(e[7]=p=>H.value=p),placeholder:"请输入定制化标签",style:{width:"300px"}},null,8,["modelValue"])])]),a("div",qt,[Qt,a("span",Zt,h(((ve=l.value.video)==null?void 0:ve.asset_id)||"-"),1)]),a("div",Wt,[Xt,a("span",Gt,h(je((_e=l.value.video)==null?void 0:_e.duration)),1)]),a("div",Yt,[ea,a("div",ta,[i(y,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=p=>E.value=p)},{default:u(()=>[i(v,{value:"online"},{default:u(()=>[f("上架")]),_:1}),i(v,{value:"offline"},{default:u(()=>[f("下架")]),_:1})]),_:1},8,["modelValue"])])]),a("div",aa,[sa,a("div",oa,[i(o,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=p=>V.value=p),placeholder:"选择合集名称",style:{width:"300px"},options:ee.value,clearable:"",filterable:""},null,8,["modelValue","options"])])]),a("div",la,[i(_,{theme:"primary",size:"small",onClick:Qe,loading:oe.value},{default:u(()=>[f(" 保存修改 ")]),_:1},8,["loading"])])]),a("div",ia,[a("div",na,[da,a("span",ra,h(((pe=l.value.video)==null?void 0:pe.watch_cnt)||0),1)]),a("div",ua,[ca,a("span",va,h(((me=l.value.video)==null?void 0:me.watch_complete_cnt)||0),1)]),a("div",_a,[pa,a("span",ma,h(((ge=l.value.video)==null?void 0:ge.like_cnt)||0),1)]),a("div",ga,[ha,a("span",fa,h(((he=l.value.video)==null?void 0:he.favorite_cnt)||0),1)])]),a("div",ya,[a("div",ba,[Sa,a("span",ka,h(((ye=(fe=l.value.video)==null?void 0:fe.series)==null?void 0:ye.id)||"-"),1)]),a("div",xa,[wa,a("div",Va,[i(o,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=p=>V.value=p),placeholder:"选择合集名称",style:{width:"300px"},options:ee.value,clearable:"",filterable:""},null,8,["modelValue","options"])])]),a("div",Ia,[Na,a("span",Ca,h(((Se=(be=l.value.video)==null?void 0:be.series)==null?void 0:Se.level)==="<UNSET>"?"未配置":((xe=(ke=l.value.video)==null?void 0:ke.series)==null?void 0:xe.level)||"-"),1)]),a("div",$a,[Da,a("span",za,h(((Ie=(Ve=(we=l.value.video)==null?void 0:we.series)==null?void 0:Ve.interest_list)==null?void 0:Ie.join(", "))||"-"),1)])])])])):ze("",!0)]}),_:1},8,["visible"])])}}});const Oa=ot(Ua,[["__scopeId","data-v-d3253ee0"]]);export{Oa as default};
