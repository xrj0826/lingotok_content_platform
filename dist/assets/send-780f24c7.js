import{d as h,r as V,a as C,b as d,o as S,c as k,e as t,w as o,f as m,g as D,h as q,D as U,M as p,i as N,C as R,_ as z}from"./index-794815f9.js";const B=h({__name:"send",setup(M){const f=V(),c=V(!1),e=C({globalSend:!1,userIds:"",titleEn:"",contentEn:"",titleAr:"",contentAr:"",sendType:"notice"}),g={userIds:[{required:!0,message:"请输入用户ID",validator:s=>e.globalSend?!0:!!s}],titleEn:[{required:!0,message:"请输入英文标题"}],contentEn:[{required:!0,message:"请输入英文内容"}],titleAr:[{required:!0,message:"请输入阿拉伯语标题"}],contentAr:[{required:!0,message:"请输入阿拉伯语内容"}],sendType:[{required:!0,message:"请选择发送类型"}]};function v(s){const i=`create_notice${s}lingotok`;return R.SHA256(i).toString()}async function w(s){var a,u;const n=Date.now().toString(),i={Timestamp:n,Signature:v(n)};try{const r=await N.post("https://api.lingotok.ai/api/v1/notice/create_notice",s,{headers:i});if(((a=r.data)==null?void 0:a.code)===200)p.success("发送成功"),b();else throw new Error(((u=r.data)==null?void 0:u.message)||"发送失败")}catch(r){console.error("发送失败:",r),p.error("发送失败："+(r.message||"未知错误"))}}async function E({validateResult:s,firstError:n}){if(s===!0){const i=e.globalSend?"确定要向所有用户发送站内信吗？":"确定要发送站内信吗？",a=U.confirm({header:"确认发送",body:i,onConfirm:async()=>{c.value=!0;try{const u={notice:e.sendType==="notice"||e.sendType==="both",push:e.sendType==="push"||e.sendType==="both",global_send:e.globalSend,title_en:e.titleEn,content_en:e.contentEn,title_ar:e.titleAr,content_ar:e.contentAr};e.globalSend||(u.user_id_list=e.userIds.split(",").map(r=>r.trim())),await w(u),a.destroy()}finally{c.value=!1}},onClose:()=>{a.destroy()},closeOnOverlayClick:!0})}else p.error(n)}function b(){var s;(s=f.value)==null||s.reset(),e.globalSend=!1,e.sendType="notice"}return(s,n)=>{const i=d("t-switch"),a=d("t-form-item"),u=d("t-textarea"),r=d("t-input"),_=d("t-radio-button"),x=d("t-radio-group"),y=d("t-button"),A=d("t-space"),T=d("t-form"),I=d("t-card");return S(),k("div",null,[t(I,{class:"notice-send-container",bordered:!1},{header:o(()=>[m("发送站内信")]),default:o(()=>[t(T,{ref_key:"form",ref:f,data:e,rules:g,onSubmit:E},{default:o(()=>[t(a,{name:"globalSend",label:"批量发送"},{default:o(()=>[t(i,{modelValue:e.globalSend,"onUpdate:modelValue":n[0]||(n[0]=l=>e.globalSend=l)},null,8,["modelValue"])]),_:1}),e.globalSend?q("",!0):(S(),D(a,{key:0,name:"userIds",label:"用户ID",rules:g.userIds},{default:o(()=>[t(u,{modelValue:e.userIds,"onUpdate:modelValue":n[1]||(n[1]=l=>e.userIds=l),placeholder:"请输入用户ID，多个ID请用英文逗号分隔",autosize:{minRows:2,maxRows:5}},null,8,["modelValue"])]),_:1},8,["rules"])),t(a,{name:"titleEn",label:"英文标题"},{default:o(()=>[t(r,{modelValue:e.titleEn,"onUpdate:modelValue":n[2]||(n[2]=l=>e.titleEn=l),placeholder:"请输入英文标题"},null,8,["modelValue"])]),_:1}),t(a,{name:"contentEn",label:"英文内容"},{default:o(()=>[t(u,{modelValue:e.contentEn,"onUpdate:modelValue":n[3]||(n[3]=l=>e.contentEn=l),placeholder:"请输入英文内容",autosize:{minRows:3,maxRows:10}},null,8,["modelValue"])]),_:1}),t(a,{name:"titleAr",label:"阿拉伯语标题"},{default:o(()=>[t(r,{modelValue:e.titleAr,"onUpdate:modelValue":n[4]||(n[4]=l=>e.titleAr=l),placeholder:"请输入阿拉伯语标题"},null,8,["modelValue"])]),_:1}),t(a,{name:"contentAr",label:"阿拉伯语内容"},{default:o(()=>[t(u,{modelValue:e.contentAr,"onUpdate:modelValue":n[5]||(n[5]=l=>e.contentAr=l),placeholder:"请输入阿拉伯语内容",autosize:{minRows:3,maxRows:10}},null,8,["modelValue"])]),_:1}),t(a,{name:"sendType",label:"发送类型"},{default:o(()=>[t(x,{modelValue:e.sendType,"onUpdate:modelValue":n[6]||(n[6]=l=>e.sendType=l)},{default:o(()=>[t(_,{value:"notice"},{default:o(()=>[m("仅站内信")]),_:1}),t(_,{value:"push"},{default:o(()=>[m("仅推送")]),_:1}),t(_,{value:"both"},{default:o(()=>[m("站内信+推送")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(a,null,{default:o(()=>[t(A,null,{default:o(()=>[t(y,{theme:"primary",type:"submit",loading:c.value},{default:o(()=>[m("发送")]),_:1},8,["loading"]),t(y,{theme:"default",onClick:b},{default:o(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}});const P=z(B,[["__scopeId","data-v-8caf9836"]]);export{P as default};
